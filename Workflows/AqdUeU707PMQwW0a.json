{"updatedAt":"2025-12-07T14:23:22.222Z","createdAt":"2025-12-06T21:51:59.573Z","id":"AqdUeU707PMQwW0a","name":"[TERRA] Gerenciador de editores de v√≠deos","active":true,"isArchived":false,"nodes":[{"parameters":{"httpMethod":"POST","path":"N8N-Terra-Gerenciador-de-editores-de-videos","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[256,80],"id":"054c83db-716d-418e-b678-b86118a1cd18","name":"Webhook","webhookId":"4ad31eba-1597-45cc-bf95-b58c4260d9ed"},{"parameters":{"assignments":{"assignments":[{"id":"73fa7e51-79b6-48f9-8fd7-c5525ba051f6","name":"body.atrasos","value":"={{ $json.body.atrasos }}","type":"array"},{"id":"96b84e53-ac1a-4ef2-bc15-13714b7c5609","name":"body.administradores","value":"={{ $json.body.administradores }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[464,80],"id":"c467397b-a1bc-4b12-8e09-987b67a294ac","name":"Variaveis"},{"parameters":{"jsCode":"// Acessa o array de atrasos\nconst atrasos = $input.item.json.body.atrasos;\n\n// Fun√ß√£o para formatar data de YYYY-MM-DD para DD/MM/AA\nfunction formatarData(dataStr) {\n  const [ano, mes, dia] = dataStr.split('-');\n  const anoAbreviado = ano.slice(-2); // Pega os 2 √∫ltimos d√≠gitos do ano\n  return `${dia}/${mes}/${anoAbreviado}`;\n}\n\n// Formata a mensagem\nlet mensagem = \"üö® *Alertas de Atrasos em Projetos*\\n\\n\";\n\natrasos.forEach((atraso, index) => {\n  mensagem += `*${index + 1}. ${atraso.projeto}*\\n`;\n  mensagem += `üìã Etapa: ${atraso.etapa}\\n`;\n  mensagem += `üìÖ Data prevista: ${formatarData(atraso.data_prevista)}\\n`;\n  mensagem += `üë§ Respons√°vel: ${atraso.responsavel}\\n\\n`;\n});\n\n// Retorna um √∫nico item com a mensagem formatada\nreturn {\n  mensagem: mensagem.trim()\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[672,80],"id":"4bc8af89-47aa-4a99-8032-9da2e09d5417","name":"Prepara a mensagem"},{"parameters":{"resource":"messages-api","instanceName":"Rich","remoteJid":"={{ $json.whatsapp }}","messageText":"=‚ú®{{ $json.mensagem }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1344,192],"id":"29e6928d-3e1a-4a02-86a8-17fc66ffb150","name":"Enviar texto","credentials":{"evolutionApi":{"id":"gqMlUQxrxPNWPCn1","name":"Evolution - Hetzner Scala Server-1"}}},{"parameters":{"jsCode":"// Acessa os dados do n√≥ Variaveis\nconst variaveis = $item(\"0\").$node[\"Variaveis\"].json;\n\n// Verifica se os dados existem\nif (!variaveis || !variaveis.body) {\n  throw new Error('N√≥ Variaveis n√£o encontrado ou sem dados');\n}\n\nconst atrasos = variaveis.body.atrasos;\nconst administradores = variaveis.body.administradores;\n\n// Verifica se h√° atrasos e administradores\nif (!atrasos || atrasos.length === 0) {\n  throw new Error('Nenhum atraso encontrado');\n}\n\nif (!administradores || administradores.length === 0) {\n  throw new Error('Nenhum administrador encontrado');\n}\n\n// Formata data\nfunction formatarData(dataStr) {\n  const [ano, mes, dia] = dataStr.split('-');\n  return `${dia}/${mes}/${ano.slice(-2)}`;\n}\n\n// Formata n√∫mero de WhatsApp\nfunction formatarWhatsApp(numero) {\n  const apenasNumeros = numero.replace(/\\D/g, '');\n  return apenasNumeros.startsWith('55') ? apenasNumeros : '55' + apenasNumeros;\n}\n\n// Cria a mensagem\nlet mensagem = \"üö® *Alertas de Atrasos em Projetos*\\n\\n\";\natrasos.forEach((atraso, index) => {\n  mensagem += `*${index + 1}. ${atraso.projeto}*\\n`;\n  mensagem += `üìã Etapa: ${atraso.etapa}\\n`;\n  mensagem += `üìÖ Data prevista: ${formatarData(atraso.data_prevista)}\\n`;\n  mensagem += `üë§ Respons√°vel: ${atraso.responsavel}\\n\\n`;\n});\n\n// Retorna um item para cada administrador\nreturn administradores.map(admin => ({\n  nome: admin.nome_completo,\n  whatsapp: formatarWhatsApp(admin.whatsapp),\n  mensagem: mensagem.trim()\n}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[880,80],"id":"550e7790-cd66-46f4-ac22-0ae481ab597c","name":"Pega os n√∫meros dos admin"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1088,80],"id":"537d1adc-986c-4ee8-8bbb-9f995c394e04","name":"Loop Over Items"}],"connections":{"Webhook":{"main":[[{"node":"Variaveis","type":"main","index":0}]]},"Variaveis":{"main":[[{"node":"Prepara a mensagem","type":"main","index":0}]]},"Prepara a mensagem":{"main":[[{"node":"Pega os n√∫meros dos admin","type":"main","index":0}]]},"Pega os n√∫meros dos admin":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Enviar texto","type":"main","index":0}]]},"Enviar texto":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"sdn8n.scaladigital.com.br","user-agent":"Deno/2.1.4 (variant; SupabaseEdgeRuntime/1.69.25)","content-length":"494","accept":"*/*","accept-encoding":"gzip,br","accept-language":"*","content-type":"application/json","x-forwarded-for":"44.198.192.228","x-forwarded-host":"sdn8n.scaladigital.com.br","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"9ffe90470d6d","x-real-ip":"44.198.192.228"},"params":{},"query":{},"body":{"atrasos":[{"projeto":"DEVE teste 2","etapa":"Grava√ß√£o","data_prevista":"2025-12-02","responsavel":"torresnet","whatsapp":"(62) 99244-5646"},{"projeto":"DVD TESTE","etapa":"Grava√ß√£o","data_prevista":"2025-12-03","responsavel":"Alessandro Torres","whatsapp":"(62) 99244-5646"}],"administradores":[{"nome_completo":"Rafael Terra","whatsapp":"(62) 98159-4456"},{"nome_completo":"torresnet","whatsapp":"(62) 99244-5646"}],"timestamp":"2025-12-07T14:16:30.943Z","mensagem":"Atrasos detectados"},"webhookUrl":"https://sdn8n.scaladigital.com.br/webhook/N8N-Terra-Gerenciador-de-editores-de-videos","executionMode":"production"}}]},"versionId":"3b53dba8-db13-48c2-ba37-dabdd7a23d78","activeVersionId":"3b53dba8-db13-48c2-ba37-dabdd7a23d78","triggerCount":1,"shared":[{"updatedAt":"2025-12-06T21:51:59.573Z","createdAt":"2025-12-06T21:51:59.573Z","role":"workflow:owner","workflowId":"AqdUeU707PMQwW0a","projectId":"Cf0rhzAQivp560yX"}],"activeVersion":{"updatedAt":"2025-12-07T14:23:22.236Z","createdAt":"2025-12-07T14:23:22.236Z","versionId":"3b53dba8-db13-48c2-ba37-dabdd7a23d78","workflowId":"AqdUeU707PMQwW0a","nodes":[{"parameters":{"httpMethod":"POST","path":"N8N-Terra-Gerenciador-de-editores-de-videos","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[256,80],"id":"054c83db-716d-418e-b678-b86118a1cd18","name":"Webhook","webhookId":"4ad31eba-1597-45cc-bf95-b58c4260d9ed"},{"parameters":{"assignments":{"assignments":[{"id":"73fa7e51-79b6-48f9-8fd7-c5525ba051f6","name":"body.atrasos","value":"={{ $json.body.atrasos }}","type":"array"},{"id":"96b84e53-ac1a-4ef2-bc15-13714b7c5609","name":"body.administradores","value":"={{ $json.body.administradores }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[464,80],"id":"c467397b-a1bc-4b12-8e09-987b67a294ac","name":"Variaveis"},{"parameters":{"jsCode":"// Acessa o array de atrasos\nconst atrasos = $input.item.json.body.atrasos;\n\n// Fun√ß√£o para formatar data de YYYY-MM-DD para DD/MM/AA\nfunction formatarData(dataStr) {\n  const [ano, mes, dia] = dataStr.split('-');\n  const anoAbreviado = ano.slice(-2); // Pega os 2 √∫ltimos d√≠gitos do ano\n  return `${dia}/${mes}/${anoAbreviado}`;\n}\n\n// Formata a mensagem\nlet mensagem = \"üö® *Alertas de Atrasos em Projetos*\\n\\n\";\n\natrasos.forEach((atraso, index) => {\n  mensagem += `*${index + 1}. ${atraso.projeto}*\\n`;\n  mensagem += `üìã Etapa: ${atraso.etapa}\\n`;\n  mensagem += `üìÖ Data prevista: ${formatarData(atraso.data_prevista)}\\n`;\n  mensagem += `üë§ Respons√°vel: ${atraso.responsavel}\\n\\n`;\n});\n\n// Retorna um √∫nico item com a mensagem formatada\nreturn {\n  mensagem: mensagem.trim()\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[672,80],"id":"4bc8af89-47aa-4a99-8032-9da2e09d5417","name":"Prepara a mensagem"},{"parameters":{"resource":"messages-api","instanceName":"Rich","remoteJid":"={{ $json.whatsapp }}","messageText":"=‚ú®{{ $json.mensagem }}","options_message":{}},"type":"n8n-nodes-evolution-api.evolutionApi","typeVersion":1,"position":[1344,192],"id":"29e6928d-3e1a-4a02-86a8-17fc66ffb150","name":"Enviar texto","credentials":{"evolutionApi":{"id":"gqMlUQxrxPNWPCn1","name":"Evolution - Hetzner Scala Server-1"}}},{"parameters":{"jsCode":"// Acessa os dados do n√≥ Variaveis\nconst variaveis = $item(\"0\").$node[\"Variaveis\"].json;\n\n// Verifica se os dados existem\nif (!variaveis || !variaveis.body) {\n  throw new Error('N√≥ Variaveis n√£o encontrado ou sem dados');\n}\n\nconst atrasos = variaveis.body.atrasos;\nconst administradores = variaveis.body.administradores;\n\n// Verifica se h√° atrasos e administradores\nif (!atrasos || atrasos.length === 0) {\n  throw new Error('Nenhum atraso encontrado');\n}\n\nif (!administradores || administradores.length === 0) {\n  throw new Error('Nenhum administrador encontrado');\n}\n\n// Formata data\nfunction formatarData(dataStr) {\n  const [ano, mes, dia] = dataStr.split('-');\n  return `${dia}/${mes}/${ano.slice(-2)}`;\n}\n\n// Formata n√∫mero de WhatsApp\nfunction formatarWhatsApp(numero) {\n  const apenasNumeros = numero.replace(/\\D/g, '');\n  return apenasNumeros.startsWith('55') ? apenasNumeros : '55' + apenasNumeros;\n}\n\n// Cria a mensagem\nlet mensagem = \"üö® *Alertas de Atrasos em Projetos*\\n\\n\";\natrasos.forEach((atraso, index) => {\n  mensagem += `*${index + 1}. ${atraso.projeto}*\\n`;\n  mensagem += `üìã Etapa: ${atraso.etapa}\\n`;\n  mensagem += `üìÖ Data prevista: ${formatarData(atraso.data_prevista)}\\n`;\n  mensagem += `üë§ Respons√°vel: ${atraso.responsavel}\\n\\n`;\n});\n\n// Retorna um item para cada administrador\nreturn administradores.map(admin => ({\n  nome: admin.nome_completo,\n  whatsapp: formatarWhatsApp(admin.whatsapp),\n  mensagem: mensagem.trim()\n}));"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[880,80],"id":"550e7790-cd66-46f4-ac22-0ae481ab597c","name":"Pega os n√∫meros dos admin"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1088,80],"id":"537d1adc-986c-4ee8-8bbb-9f995c394e04","name":"Loop Over Items"}],"connections":{"Webhook":{"main":[[{"node":"Variaveis","type":"main","index":0}]]},"Variaveis":{"main":[[{"node":"Prepara a mensagem","type":"main","index":0}]]},"Prepara a mensagem":{"main":[[{"node":"Pega os n√∫meros dos admin","type":"main","index":0}]]},"Pega os n√∫meros dos admin":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Enviar texto","type":"main","index":0}]]},"Enviar texto":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}},"authors":"Alessadro Torres","name":null,"description":null,"autosaved":false},"tags":[]}tete