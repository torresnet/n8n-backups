{"updatedAt":"2025-11-27T15:30:06.450Z","createdAt":"2025-11-27T15:24:47.772Z","id":"Qk9qibHcoQELRs2x","name":"Build a RAG system by uploading PDFs to the Google Gemini File Search Store","active":false,"isArchived":false,"nodes":[{"parameters":{},"id":"62bd25f1-61b6-473a-ad59-3642cb110ed0","name":"When clicking ‚ÄòExecute workflow‚Äô","type":"n8n-nodes-base.manualTrigger","position":[368,240],"typeVersion":1},{"parameters":{"formTitle":"Test","formDescription":"Test","formFields":{"values":[{"fieldLabel":"File","fieldType":"file","requiredField":true}]},"options":{}},"id":"e66227cc-73c9-42a8-9f73-da6c4139ef7d","name":"On form submission","type":"n8n-nodes-base.formTrigger","position":[352,624],"webhookId":"66af9d33-0d74-4728-8773-19734330131b","typeVersion":2.3},{"parameters":{"mode":"combine","combineBy":"combineAll","options":{}},"id":"9aabf070-e13f-48be-af40-8e8bc5bb541d","name":"Merge","type":"n8n-nodes-base.merge","position":[832,608],"typeVersion":3.2},{"parameters":{"options":{}},"id":"d693f266-3d04-4c5f-ba4b-c5e7b34c85fd","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","position":[368,1104],"webhookId":"7281e605-81d4-4837-b454-149c474fe012","typeVersion":1.4},{"parameters":{"options":{}},"id":"ca48038f-4d02-4baf-a233-b80867a40bef","name":"Google Gemini Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","position":[1136,1280],"typeVersion":1,"credentials":{"googlePalmApi":{"id":"ktHvSkW6TllnEYHe","name":"Google Gemini(PaLM) Api (torresnet)"}}},{"parameters":{"mode":"combine","combineBy":"combineAll","options":{}},"id":"a98fa97f-e25d-44a4-bc7c-45f7f91c9cab","name":"Merge1","type":"n8n-nodes-base.merge","position":[832,1088],"typeVersion":3.2},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"XXX"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"contents\": [\n    {\n      \"parts\": [\n        {\n          \"text\":\"{{ $fromAI(\"query\",\"the question the user needs an answer to\") }}\"\n        }\n      ]\n    }\n  ],\n  \"tools\": [\n    {\n      \"file_search\": {\n        \"file_search_store_names\": [\n          \"{{ $('Get Store1').item.json['Search Store'] }}\"\n        ]\n      }\n    }\n  ]\n}","options":{}},"id":"8e15d69d-2283-4320-b1e5-a22155d6ac2a","name":"SearchStore","type":"n8n-nodes-base.httpRequestTool","position":[1472,1264],"typeVersion":4.3},{"parameters":{},"id":"15ad91ee-e9b0-42a7-a47a-3ae8bde1b1ac","name":"Simple Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","position":[1296,1280],"typeVersion":1.3},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/v1beta/fileSearchStores","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"XXX"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"displayName","value":"XXX"}]},"options":{}},"id":"2346983a-5aba-4a96-97fe-00f9527871bb","name":"Create Store","type":"n8n-nodes-base.httpRequest","position":[640,240],"typeVersion":4.3},{"parameters":{"method":"POST","url":"https://generativelanguage.googleapis.com/upload/v1beta/files","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"XXX"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"contentType":"binaryData","inputDataFieldName":"File","options":{}},"id":"6896edef-1a7c-4f8d-ad76-407f8be20315","name":"Upload File","type":"n8n-nodes-base.httpRequest","position":[1136,608],"typeVersion":4.3},{"parameters":{"method":"POST","url":"=https://generativelanguage.googleapis.com/v1beta/{{ $('Get Store').item.json['Search Store'] }}:importFile","sendQuery":true,"queryParameters":{"parameters":[{"name":"key","value":"XXX"}]},"sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n    \"file_name\":\"{{ $json.file.name }}\"\n} ","options":{}},"id":"3b42498a-c54e-4409-84a7-9ff57f386448","name":"Import to Store","type":"n8n-nodes-base.httpRequest","position":[1344,608],"typeVersion":4.3},{"parameters":{"assignments":{"assignments":[{"id":"612266b5-c5c0-4091-875e-50cd729cda11","name":"Search Store","type":"string","value":"fileSearchStores/my-store-XXX"}]},"options":{}},"id":"00059810-17e5-41aa-9787-6fff626b182a","name":"Get Store1","type":"n8n-nodes-base.set","position":[608,976],"typeVersion":3.4},{"parameters":{"options":{"systemMessage":"You are a helpful assistant. For every question you are asked, always search with the SearchStore tool"}},"id":"29356ea0-043e-438a-acbf-99be816475f8","name":"Rag Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[1168,1088],"typeVersion":3},{"parameters":{"content":"```json\n[\n  {\n    \"name\": \"fileSearchStores/my-store-XXXXX\",\n    \"displayName\": \"My Store\",\n    \"createTime\": \"2025-11-22T16:33:57.084623Z\",\n    \"updateTime\": \"2025-11-22T16:33:57.084623Z\"\n  }\n]\n```","height":208,"width":512,"color":6},"id":"c5c834de-6a73-4a23-9eef-cbc199ee23ad","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[880,208],"typeVersion":1},{"parameters":{"content":"## PASSO 1 - Criar um novo Search Store (Reposit√≥rio de Busca) üõçÔ∏è\n\nAcionada manualmente atrav√©s do n√≥ *‚ÄúExecute workflow‚Äù* (Executar fluxo de trabalho), esta etapa envia uma requisi√ß√£o para a API Gemini para criar um **FileSearch Store**, que funciona como um **√≠ndice vetorial** privado para seus documentos.","height":352,"width":1024,"color":7},"id":"42c59588-e8a2-4265-a49c-ff982c8e00e5","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[560,96],"typeVersion":1},{"parameters":{"content":"## PASSO 2 - Carregar um novo arquivo para o Search Store (Reposit√≥rio de Busca) üìÅ\n\nCarregar e importar um arquivo para o Search Store.","height":352,"width":512,"color":7},"id":"c998f2ea-1721-482a-91ed-bb67cbb06359","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[1056,464],"typeVersion":1},{"parameters":{"content":"## PASSO 3 - Contexto Recuperado do Search Store (Reposit√≥rio de Busca) üí¨\n\nQuando uma mensagem de chat √© recebida:\n\n* O fluxo de trabalho carrega o **identificador do Search Store**.\n* Um *Agente LangChain* √© utilizado juntamente com o **Modelo de Chat Google Gemini**.\n* O modelo √© configurado para **sempre usar a ferramenta SearchStore**.","height":592,"width":512,"color":7},"id":"c96e1b19-2108-4a6b-a78f-b15bb540e97a","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[1056,832],"typeVersion":1},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nDefina o Search Store criado no PASSO 1 (por exemplo, fileSearchStores/my-store-XXXXX)\n\n","height":960,"width":208,"color":7},"id":"72071705-f8e2-4919-a156-742b6a9bbd8a","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[560,464],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"612266b5-c5c0-4091-875e-50cd729cda11","name":"Search Store","type":"string","value":"fileSearchStores/my-store-XXX"}]},"options":{}},"id":"7128fcb3-49b8-41ca-bab3-17942a5042b8","name":"Get Store","type":"n8n-nodes-base.set","position":[608,528],"typeVersion":3.4},{"parameters":{"content":"## RAG com Google Gemini Search Store\n\nEste fluxo de trabalho implementa um sistema de Gera√ß√£o Aumentada por Recupera√ß√£o (RAG - Retrieval-Augmented Generation) usando a API File Search do Google Gemini. Ele permite que os usu√°rios carreguem arquivos em um reposit√≥rio de busca dedicado e, em seguida, fa√ßam perguntas sobre o conte√∫do desses arquivos em uma interface de chat.\n\nO sistema recupera automaticamente informa√ß√µes relevantes dos arquivos carregados para fornecer respostas precisas e com consci√™ncia de contexto.\n\n### **Como funciona:**\n\nEste fluxo de trabalho cria um pipeline RAG totalmente automatizado usando a API File Search do Google Gemini. Ele come√ßa criando um **File Search Store** privado para armazenar e indexar documentos carregados. Quando os usu√°rios enviam um arquivo atrav√©s do formul√°rio, o fluxo de trabalho o carrega e o importa para o reposit√≥rio, tornando-o pesquis√°vel. Durante uma sess√£o de chat, o modelo Gemini ‚Äî configurado com um Agente LangChain ‚Äî recupera automaticamente o conte√∫do relevante dos arquivos indexados para gerar respostas com consci√™ncia de contexto. Isso garante que cada consulta seja informada pelos documentos fornecidos pelo usu√°rio, possibilitando uma experi√™ncia de chatbot RAG precisa e escal√°vel dentro do n8n.\n\n### **Etapas de Configura√ß√£o:**\n\nComece adicionando sua chave de API v√°lida do Google Gemini a todos os n√≥s de Requisi√ß√£o HTTP que lidam com a cria√ß√£o do reposit√≥rio, upload de arquivos e opera√ß√µes de busca. Em seguida, execute manualmente o n√≥ \"**Create Store**\" para gerar um novo **File Search Store** e copie o nome do recurso dele. Atualize os n√≥s \"**Get Store**\" e \"**Get Store1**\" com esse valor para vincular o fluxo de trabalho ao seu reposit√≥rio. Finalmente, ative o fluxo de trabalho para expor URLs p√∫blicas para upload de arquivos e gatilhos de chat, que podem ser incorporados em interfaces externas para intera√ß√£o do usu√°rio final. Uma vez configurado, os usu√°rios podem carregar arquivos e consult√°-los via chat de forma integrada.\n","height":576,"width":1024},"id":"0fd1dfbe-fd89-412a-9464-a390dc52caf2","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[560,-528],"typeVersion":1}],"connections":{"Merge":{"main":[[{"node":"Upload File","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Rag Agent","type":"main","index":0}]]},"Get Store":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Get Store1":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"SearchStore":{"ai_tool":[[{"node":"Rag Agent","type":"ai_tool","index":0}]]},"Upload File":{"main":[[{"node":"Import to Store","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"Rag Agent","type":"ai_memory","index":0}]]},"On form submission":{"main":[[{"node":"Merge","type":"main","index":1},{"node":"Get Store","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Rag Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"Get Store1","type":"main","index":0},{"node":"Merge1","type":"main","index":1}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Create Store","type":"main","index":0}]]}},"settings":{},"staticData":null,"meta":{"templateId":"11197"},"pinData":{},"versionId":"fe4e39c9-dad7-4e2e-9dbc-1b20100e66f7","activeVersionId":null,"triggerCount":0,"shared":[{"updatedAt":"2025-11-27T15:24:47.772Z","createdAt":"2025-11-27T15:24:47.772Z","role":"workflow:owner","workflowId":"Qk9qibHcoQELRs2x","projectId":"Cf0rhzAQivp560yX"}],"activeVersion":null,"tags":[]}tete