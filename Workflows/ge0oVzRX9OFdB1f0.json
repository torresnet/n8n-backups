{"updatedAt":"2025-11-20T22:15:14.504Z","createdAt":"2025-11-20T21:57:25.168Z","id":"ge0oVzRX9OFdB1f0","name":"[ Clave ] Processamento de álbum","active":true,"isArchived":false,"nodes":[{"parameters":{"promptType":"define","text":"={{ $json.html_extraido }}\n\nVocê é um raspador de dados profissional especializado em metadados musicais.\n\nExtraia apenas os metadados da música fornecida acima e retorne **somente JSON puro**, sem explicações, comentários ou texto fora do JSON.\n\nSiga exatamente este formato:\n\n{\n  \"artista\": \"Nome do artista\",\n  \"album\": \"Nome do álbum\",\n  \"faixas\": [\n    {\n      \"numero\": 1,\n      \"titulo\": \"Título da música\",\n      \"genero_principal\": \"Pop\",\n      \"artistas_participantes\": [\"Artista 1\", \"Artista 2\"],\n      \"compositores\": [\"Compositor 1\"],\n      \"produtores\": [\"Produtor 1\"],\n      \"vocalistas\": [\"Vocalista 1\"],\n      \"classificacao\": \"Livre\",\n      \"idioma\": \"Português\",\n      \"autoral\": \"Sim\",\n      \"isrc\": \"BR-XXX-23-00001\",\n      \"instrumental\": \"Não\",\n      \"remix\": \"Não\",\n      \"genero_secundario\": \"Eletrônico\",\n      \"preview_tiktok\": \"0:30seg\"\n    }\n  ]\n}\n\n⚠️ Regras:\n- Todos os campos devem estar presentes, mesmo se for \"Desconhecido\".\n- \"numero\" deve ser um número (sem aspas).\n- Retorne exatamente um único objeto JSON.\n- Não adicione ```json, texto introdutório ou comentários.","hasOutputParser":true,"options":{"systemMessage":"Retorne APENAS um objeto JSON válido sem nenhum texto adicional.\n\nEstrutura obrigatória:\n{\n\"artista\": \"nome do artista\",\n\"album\": \"nome do album\",\n\"genero\": \"genero musical do album\" (sertanejo, forró, rock),\n\"data de lançamento\": \"dd/mm/aaaa\",\n\"UPC\": \"upc do album\",\n\"Link da capa\": \"link da imagem da capa\",\n\"faixas\": [\n{\n\"numero\": 1,\n\"titulo\": \"nome da música\",\n\"genero_principal\": \"Sertanejo\",\n\"genero_secundario\": \"Eletrônico\",\n\"compositores\": [\"Compositor 1\"],\n\"produtores\": [\"Produtor 1\"],\n\"vocalistas\": [\"Vocalista 1\"],\n\"classificacao\": \"Livre\",\n\"idioma\": \"Português\",\n\"autoral\": \"Sim\",\n\"isrc\": \"BR-XXX-23-00001\",\n\"instrumental\": \"Não\",\n\"remix\": \"Não\",\n\"preview_tiktok\": \"0:30seg\"\n}\n]\n}\n\nNÃO adicione explicações. NÃO use markdown. Retorne SOMENTE o JSON."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[224,272],"id":"edfb8632-b764-4cbb-85d6-bd9a6b256755","name":"AI Agent"},{"parameters":{"options":{"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[160,432],"id":"5ac29888-d701-4032-9260-3f3d02c52971","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"ktHvSkW6TllnEYHe","name":"Google Gemini(PaLM) Api (torresnet)"}}},{"parameters":{"assignments":{"assignments":[{"id":"63a49f2c-3fc6-451d-abaf-14a2e35a49f0","name":"v_html","value":"={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"conteúdo_html\"] }}","type":"string"},{"id":"ce13461c-6bf2-450d-b0df-85d365ca9b6d","name":"v_gravadora","value":"={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"gravadora\"] }}","type":"string"},{"id":"c31bf3a5-e8c0-47c4-b821-31123ea171d5","name":"v_codigo_gravadora","value":"={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"codigo_gravadora\"] }}","type":"string"},{"id":"209f7d05-22ce-4bdf-a23f-b78489c52418","name":"v_url_projeto_supabase","value":"https://luelnwzqzngqtoewdrnk.supabase.co","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-224,272],"id":"b660ad3b-f83d-4286-84a2-fee2cd69f22d","name":"Parametros"},{"parameters":{"jsCode":"const htmlContent = $input.first().json.v_html;\n\n// Limpa e prepara o HTML\nconst cleanHtml = htmlContent\n  .replace(/\\n/g, ' ')\n  .replace(/\\s+/g, ' ')\n  .trim();\n\nreturn {\n  html_extraido: cleanHtml\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[0,272],"id":"598811a5-0b80-484b-889d-98fdbb4dd172","name":"Limpa dados"},{"parameters":{"httpMethod":"POST","path":"clavehook","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-448,272],"id":"0d9b4394-7ea3-4ec4-91d1-4742ff41bb45","name":"Webhook","webhookId":"bd94ad41-5e72-4d1c-b79a-9840d74fff9c"},{"parameters":{"respondWith":"json","responseBody":"={\n  \"status\": \"processando\",\n  \"mensagem\": \"Álbum aceito para processamento\",\n  \"album\": \"{{ $('Parametros').item.json.v_gravadora }}\",\n  \"codigo_gravadora\": \"{{ $('Parametros').item.json.v_codigo_gravadora }}\",\n  \"timestamp\": \"{{ new Date().toISOString() }}\"\n}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[0,0],"id":"01d2ff70-a6c6-4f00-bf75-0cd26d4d41cc","name":"Respond to Webhook"},{"parameters":{"jsCode":"let output = $input.first().json.output || $input.first().json.text || JSON.stringify($input.first().json);\n\noutput = output.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n\nconst firstBrace = output.indexOf('{');\nconst lastBrace = output.lastIndexOf('}');\n\nif (firstBrace === -1 || lastBrace === -1) {\n  throw new Error('Nenhum JSON encontrado no output');\n}\n\noutput = output.substring(firstBrace, lastBrace + 1);\n\nconst dados = JSON.parse(output);\n\nreturn [{ json: dados }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[576,272],"id":"ca2c352a-d6bd-4f21-b6bd-639aba5969b5","name":"Trata saída"},{"parameters":{"tableId":"artistas","fieldsUi":{"fieldValues":[{"fieldId":"gravadora_id","fieldValue":"={{ $('Paga id da gravadora').item.json.id }}"},{"fieldId":"nome","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"artista\"].toLowerCase().split(' ').map((w, i) => ['de','da','do','e','no','na','dos','das','nos','nas'].includes(w) && i > 0 ? w : w.charAt(0).toUpperCase() + w.slice(1)).join(' ') }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1760,368],"id":"f91b02a3-ef27-4828-8c9c-0c1c6aa046c1","name":"Cadastra artista","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{"url":"={{ $('Parametros').item.json.v_url_projeto_supabase }}/rest/v1/gravadoras","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"nome","value":"=ilike.{{ $item(\"0\").$node[\"Parametros\"].json[\"v_gravadora\"] }}"},{"name":"select","value":"*"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[864,352],"id":"64d2ff57-8233-44a7-a698-58560224ef6c","name":"Paga id da gravadora","notesInFlow":true,"credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}},"notes":"SUPABASE"},{"parameters":{"url":"={{ $('Parametros').item.json.v_url_projeto_supabase }}/rest/v1/artistas","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"nome","value":"=ilike.{{ $('Trata saída').item.json.artista }}"},{"name":"select","value":"*"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1104,352],"id":"3ec65173-e845-493a-ab42-e8145aeca234","name":"Paga artista","notesInFlow":true,"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}},"notes":"SUPABASE"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cb0ee1f0-61d7-4d91-98cd-2e1c6f36afb7","leftValue":"={{ $item(\"0\").$node[\"Artista existe?\"].json[\"gravadora_id\"] }}","rightValue":"={{ $item(\"0\").$node[\"Paga id da gravadora\"].json[\"id\"] }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1552,288],"id":"8b965729-865c-4663-bb76-c775b8ab9c12","name":"Mesma gravadora?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ea17266e-d3e2-4da7-8ae5-7c698c6d930e","leftValue":"={{ $item(\"0\").$node[\"Paga artista\"].json }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1328,352],"id":"0429c6b4-18a7-4f3b-a8d1-ba97470766c1","name":"Artista existe?"},{"parameters":{"url":"={{ $('Parametros').item.json.v_url_projeto_supabase }}/rest/v1/albuns","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"nome","value":"=ilike.{{ $('Trata saída').item.json.album }}"},{"name":"select","value":"*"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-272,800],"id":"459c5ed6-6de2-440a-aa89-0a8098449400","name":"Paga album","notesInFlow":true,"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}},"notes":"SUPABASE"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ea17266e-d3e2-4da7-8ae5-7c698c6d930e","leftValue":"={{ $item(\"0\").$node[\"Paga album\"].json }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-48,800],"id":"06eb16c7-1663-447e-8820-bde75ca8df66","name":"Álbum existe?"},{"parameters":{"tableId":"albuns","fieldsUi":{"fieldValues":[{"fieldId":"gravadora_id","fieldValue":"={{ $('Paga id da gravadora').item.json.id }}"},{"fieldId":"nome","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"album\"].toLowerCase().split(' ').map((w, i) => ['de','da','do','e','no','na','dos','das','nos','nas'].includes(w) && i > 0 ? w : w.charAt(0).toUpperCase() + w.slice(1)).join(' ') }}"},{"fieldId":"artista_id","fieldValue":"={{ $item(\"0\").$node[\"Paga artista\"].json[\"id\"] }}"},{"fieldId":"data_lancamento","fieldValue":"={{ $node[\"Trata saída\"].json[\"data de lançamento\"].split('/').reverse().join('-') }}"},{"fieldId":"link_capa_gravadora","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"Link da capa\"] }}"},{"fieldId":"upc","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"UPC\"] }}"},{"fieldId":"genero","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"genero\"] }}"},{"fieldId":"codigo_gravadora","fieldValue":"={{ $('Parametros').item.json.v_codigo_gravadora }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[288,880],"id":"16a9ee13-faa8-4ce7-a88a-63832e5c6167","name":"Cadastra álbum","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2240,432],"id":"25cbf325-2976-4267-b970-1884186ececf","name":"nada"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[496,816],"id":"1a545587-6237-45db-9471-4b9876729292","name":"nada1"},{"parameters":{"assignments":{"assignments":[{"id":"c1e9aa32-b0af-42d1-862a-1681fce7795e","name":"faixas","value":"={{ $('Trata saída').item.json.faixas }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[864,752],"id":"1d8bd4bb-218d-4edb-9bba-1a382caf93fd","name":"Faixas"},{"parameters":{"fieldToSplitOut":"faixas","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[1040,752],"id":"cc43f289-30e5-426d-a91d-61659b159ce1","name":"Split Out"},{"parameters":{"assignments":{"assignments":[{"id":"2dd81a7a-b24b-4c24-a22f-c1767a80a1b6","name":"nome","value":"={{ $json.titulo }}","type":"string"},{"id":"6cde504d-89cf-4bd7-b9e1-9c8a1679c6e1","name":"album_id","value":"={{ $('Paga album').item.json.id }}","type":"string"},{"id":"1adaecb9-8f62-4f5f-858a-744385068549","name":"isrc","value":"={{ $json.isrc === 'Desconhecido' ? null : $json.isrc }}","type":"string"},{"id":"7c515946-5634-4703-81dc-073f2b1632e9","name":"numero_faixa","value":"={{ $json.numero }}","type":"number"},{"id":"bb10733e-ea06-4f45-9382-eafa57624eca","name":"genero_principal","value":"={{ $json.genero_principal }}","type":"string"},{"id":"42ef9fb9-71c5-4a0f-9166-23f3e3919315","name":"genero_secundario","value":"={{ $json.genero_secundario === 'Desconhecido' ? null : $json.genero_secundario }}","type":"string"},{"id":"57e1f3b5-7f46-4b2d-bb0d-5bab2afdfb25","name":"compositores","value":"={{ $json.compositores }}","type":"array"},{"id":"417a6f04-ef0b-4f82-ad09-26e74a1a957b","name":"participacoes","value":"={{ $json.vocalistas }}","type":"string"},{"id":"5b4f733b-40a8-4412-b4b4-df46d2eb2242","name":"produtor","value":"={{ $json.produtores }}","type":"array"},{"id":"ab379dcf-eaa2-4c2a-9ba3-00a492a0b0b9","name":"classificacao","value":"={{ $json.classificacao }}","type":"string"},{"id":"32e50105-0ab5-491b-b514-680446b5a58a","name":"idioma","value":"={{ $json.idioma }}","type":"string"},{"id":"7c3fa2c6-f24b-435f-b58e-3b4e29aa43b4","name":"autoral","value":"={{ $json.autoral === 'Sim' }}","type":"boolean"},{"id":"e6cdb9be-1718-4d8c-91d3-2a6665fb7b6e","name":"instrumental","value":"={{ $json.instrumental === 'Sim' }}","type":"boolean"},{"id":"fa1b3fd2-8d34-4d29-a045-e17f2d9b7683","name":"remix","value":"={{ $json.remix === 'Sim' }}","type":"boolean"},{"id":"a29bbb76-dea7-4267-aaf5-952a61596b3a","name":"preview_tiktok","value":"={{ $json.preview_tiktok }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1216,752],"id":"c012b40e-6ee8-4435-8081-352881ae2ed6","name":"Dados da faixa"},{"parameters":{"operation":"update","tableId":"albuns","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $node[\"Álbum existe?\"].json[\"id\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"gravadora_id","fieldValue":"={{ $('Paga id da gravadora').item.json.id }}"},{"fieldId":"nome","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"album\"].toLowerCase().split(' ').map((w, i) => ['de','da','do','e','no','na','dos','das','nos','nas'].includes(w) && i > 0 ? w : w.charAt(0).toUpperCase() + w.slice(1)).join(' ') }}"},{"fieldId":"artista_id","fieldValue":"={{ $item(\"0\").$node[\"Paga artista\"].json[\"id\"] }}"},{"fieldId":"data_lancamento","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"data de lançamento\"].split('/').reverse().join('-') }}"},{"fieldId":"link_capa_gravadora","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"Link da capa\"] }}"},{"fieldId":"upc","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"UPC\"] }}"},{"fieldId":"genero","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"genero\"] }}"},{"fieldId":"codigo_gravadora","fieldValue":"={{ $('Parametros').item.json.v_codigo_gravadora }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[288,688],"id":"e5ddf340-de17-46d5-bbea-60b6f9a40b0e","name":"Atualiza album","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{"url":"={{ $('Parametros').item.json.v_url_projeto_supabase }}/rest/v1/musicas","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"isrc","value":"=eq.{{ $node[\"Loop Over Items\"].json[\"isrc\"] }}"},{"name":"select","value":"*"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1600,912],"id":"b2aac434-dd58-4b5e-92da-e5aaa5c34132","name":"Paga faixa","notesInFlow":true,"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}},"notes":"SUPABASE"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ea17266e-d3e2-4da7-8ae5-7c698c6d930e","leftValue":"={{ $node[\"Paga faixa\"].json }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1792,912],"id":"bb4c46bd-a384-4784-944e-af0aa9b72f34","name":"Faixa existe?"},{"parameters":{"operation":"update","tableId":"musicas","filters":{"conditions":[{"keyName":"isrc","condition":"eq","keyValue":"={{ $('Dados da faixa').item.json.isrc }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $('Dados da faixa').item.json.nome }}"},{"fieldId":"album_id","fieldValue":"={{ $('Dados da faixa').item.json.album_id }}"},{"fieldId":"numero_faixa","fieldValue":"={{ $('Dados da faixa').item.json.numero_faixa }}"},{"fieldId":"participacoes","fieldValue":"={{ $('Dados da faixa').item.json.participacoes }}"},{"fieldId":"compositores","fieldValue":"={{ $('Dados da faixa').item.json.compositores }}"},{"fieldId":"ativa","fieldValue":"=true"},{"fieldId":"produtor","fieldValue":"={{ $('Dados da faixa').item.json.produtor }}"},{"fieldId":"classificacao","fieldValue":"={{ $('Dados da faixa').item.json.classificacao }}"},{"fieldId":"genero_principal","fieldValue":"={{ $('Dados da faixa').item.json.genero_principal }}"},{"fieldId":"idioma","fieldValue":"={{ $('Dados da faixa').item.json.idioma }}"},{"fieldId":"autoral","fieldValue":"={{ $('Dados da faixa').item.json.autoral }}"},{"fieldId":"instrumental","fieldValue":"={{ $('Dados da faixa').item.json.instrumental }}"},{"fieldId":"remix","fieldValue":"={{ $('Dados da faixa').item.json.remix }}"},{"fieldId":"genero_secundario","fieldValue":"={{ $('Dados da faixa').item.json.genero_secundario }}"},{"fieldId":"preview_tiktok","fieldValue":"={{ $('Dados da faixa').item.json.preview_tiktok }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2016,800],"id":"f66e83d8-e073-4eab-a3d6-5c30f5530018","name":"Atualiza faixa","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{"tableId":"musicas","fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"nome\"] }}"},{"fieldId":"album_id","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"album_id\"] }}"},{"fieldId":"numero_faixa","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"numero_faixa\"] }}"},{"fieldId":"participacoes","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"participacoes\"] }}"},{"fieldId":"compositores","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"compositores\"] }}"},{"fieldId":"ativa","fieldValue":"=true"},{"fieldId":"produtor","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"produtor\"] }}"},{"fieldId":"classificacao","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"classificacao\"] }}"},{"fieldId":"genero_principal","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"genero_principal\"] }}"},{"fieldId":"idioma","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"idioma\"] }}"},{"fieldId":"autoral","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"autoral\"] }}"},{"fieldId":"instrumental","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"instrumental\"] }}"},{"fieldId":"remix","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"remix\"] }}"},{"fieldId":"genero_secundario","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"genero_secundario\"] }}"},{"fieldId":"preview_tiktok","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"preview_tiktok\"] }}"},{"fieldId":"isrc","fieldValue":"={{ $node[\"Loop Over Items\"].json.isrc }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2016,992],"id":"c1e9823b-1b81-4f57-ba95-2467852db5b0","name":"Cadastra faixa","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1424,752],"id":"0d698db8-1c50-4943-a87e-c88190f47bea","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2240,992],"id":"00023c01-735d-4409-b8cd-e72e25acdc73","name":"nada2"},{"parameters":{"assignments":{"assignments":[{"id":"96377f41-21bd-4d81-8afb-93ab0c8da86d","name":"v_nome_artista","value":"={{ $node[\"Trata saída\"].json[\"artista\"] }}","type":"string"},{"id":"474182cb-5093-46c7-b5c3-8f5cf51d473b","name":"v_nome_album","value":"={{ $node[\"Trata saída\"].json[\"album\"] }}","type":"string"},{"id":"756d7816-ea15-4b8a-95c5-5eaba30a83da","name":"v_quantidade_faixas","value":"={{ $node[\"Code in JavaScript\"].json[\"totalFaixas\"] }}","type":"string"},{"id":"47318b41-27eb-417f-87e7-71972f2804c1","name":"v_cod_gravadora","value":"={{ $node[\"Parametros\"].json[\"v_codigo_gravadora\"] }}","type":"string"},{"id":"b3b676dd-4787-4c6d-a25b-e947c28413d4","name":"v_id_gravadora","value":"={{ $node[\"Paga id da gravadora\"].json[\"id\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2800,608],"id":"00cf5a70-88fd-425a-bb97-ae210daefc18","name":"Preparando informações para o log"},{"parameters":{"jsCode":"// Acessa todos os itens de entrada\nconst faixas = items;\n// Calcula o número total de comentários\nconst totalFaixas = faixas.length;\n// Retorna o resultado no formato correto para o N8N\nreturn [{ json: { totalFaixas } }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2592,608],"id":"4e96d89b-2d9a-42c8-ae66-3a9fbb67551d","name":"Code in JavaScript"},{"parameters":{"content":"## Scrapping do HTML","height":416,"width":736,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-32,176],"typeVersion":1,"id":"723d79be-de40-453d-81b1-a27ddb2252b9","name":"Sticky Note"},{"parameters":{"content":"## Tratamento Artistas\n","height":416,"width":1728,"color":7},"type":"n8n-nodes-base.stickyNote","position":[752,176],"typeVersion":1,"id":"8c8a3902-5517-4070-8427-0f73fdb84ce9","name":"Sticky Note1"},{"parameters":{"content":"## Tratamento Álbum\n","height":416,"width":1264,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-560,640],"typeVersion":1,"id":"fe285e01-3d4c-4d54-a604-c257de567701","name":"Sticky Note2"},{"parameters":{"content":"## Tratamento Faixas\n","height":560,"width":1728,"color":7},"type":"n8n-nodes-base.stickyNote","position":[752,640],"typeVersion":1,"id":"b974a157-f5b9-487c-856b-97475eec3e1d","name":"Sticky Note3"},{"parameters":{"content":"## Geração de log\n","height":416,"width":1008,"color":7},"type":"n8n-nodes-base.stickyNote","position":[2528,480],"typeVersion":1,"id":"b79028aa-15e7-471d-804f-44ab6c8b044c","name":"Sticky Note4"},{"parameters":{"tableId":"log_processamento","fieldsUi":{"fieldValues":[{"fieldId":"titulo","fieldValue":"={{ $node[\"Preparando informações para o log\"].json[\"v_nome_artista\"] }}"},{"fieldId":"status","fieldValue":"true"},{"fieldId":"descricao","fieldValue":"={{ $node[\"Preparando informações para o log\"].json[\"v_nome_album\"] }} ({{ $node[\"Preparando informações para o log\"].json[\"v_quantidade_faixas\"] }} faixas)"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3024,608],"id":"ac52cdba-4b92-420f-b516-ea3a126e29ca","name":"Atualiza log","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}}],"connections":{"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Trata saída","type":"main","index":0}]]},"Parametros":{"main":[[{"node":"Limpa dados","type":"main","index":0},{"node":"Respond to Webhook","type":"main","index":0}]]},"Limpa dados":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Parametros","type":"main","index":0}]]},"Trata saída":{"main":[[{"node":"Paga id da gravadora","type":"main","index":0}]]},"Paga id da gravadora":{"main":[[{"node":"Paga artista","type":"main","index":0}]]},"Paga artista":{"main":[[{"node":"Artista existe?","type":"main","index":0}]]},"Mesma gravadora?":{"main":[[{"node":"nada","type":"main","index":0}],[{"node":"Cadastra artista","type":"main","index":0}]]},"Cadastra artista":{"main":[[{"node":"Paga artista","type":"main","index":0}]]},"Artista existe?":{"main":[[{"node":"Mesma gravadora?","type":"main","index":0}],[{"node":"Cadastra artista","type":"main","index":0}]]},"Paga album":{"main":[[{"node":"Álbum existe?","type":"main","index":0}]]},"Álbum existe?":{"main":[[{"node":"Atualiza album","type":"main","index":0}],[{"node":"Cadastra álbum","type":"main","index":0}]]},"Cadastra álbum":{"main":[[{"node":"Paga album","type":"main","index":0}]]},"nada":{"main":[[{"node":"Paga album","type":"main","index":0}]]},"nada1":{"main":[[{"node":"Faixas","type":"main","index":0}]]},"Faixas":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Dados da faixa","type":"main","index":0}]]},"Dados da faixa":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Atualiza album":{"main":[[{"node":"nada1","type":"main","index":0}]]},"Paga faixa":{"main":[[{"node":"Faixa existe?","type":"main","index":0}]]},"Faixa existe?":{"main":[[{"node":"Atualiza faixa","type":"main","index":0}],[{"node":"Cadastra faixa","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}],[{"node":"Paga faixa","type":"main","index":0}]]},"Atualiza faixa":{"main":[[{"node":"nada2","type":"main","index":0}]]},"Cadastra faixa":{"main":[[{"node":"nada2","type":"main","index":0}]]},"nada2":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Preparando informações para o log","type":"main","index":0}]]},"Preparando informações para o log":{"main":[[{"node":"Atualiza log","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{"Webhook":[{"json":{"headers":{"host":"apps-n8n.2xtadi.easypanel.host","user-agent":"ClaveStudio/1.0","content-length":"23244","accept":"application/json","accept-encoding":"br, gzip, deflate","accept-language":"*","content-type":"application/json; charset=utf-8","sec-fetch-mode":"cors","x-forwarded-for":"191.123.91.23","x-forwarded-host":"apps-n8n.2xtadi.easypanel.host","x-forwarded-port":"443","x-forwarded-proto":"https","x-forwarded-server":"78f60c1c9678","x-real-ip":"191.123.91.23"},"params":{},"query":{},"body":{"conteúdo_html":"<body>\n<app-root ng-version=\"15.2.10\"><router-outlet></router-outlet><app-layout class=\"ng-star-inserted\"><div class=\"layout-container layout-light layout-light-menu layout-light-topbar layout-static p-ripple-disabled\"><app-topbar _nghost-utr-c8=\"\"><div _ngcontent-utr-c8=\"\" class=\"layout-topbar\"><div _ngcontent-utr-c8=\"\" class=\"topbar-start\"><button _ngcontent-utr-c8=\"\" type=\"button\" class=\"topbar-menubutton p-link p-trigger transition-duration-300\"><i _ngcontent-utr-c8=\"\" class=\"pi pi-bars\"></i></button></div><div _ngcontent-utr-c8=\"\" class=\"layout-topbar-menu-section\"><app-sidebar _ngcontent-utr-c8=\"\" _nghost-utr-c5=\"\"><div _ngcontent-utr-c5=\"\" class=\"layout-sidebar\"><div _ngcontent-utr-c5=\"\" class=\"sidebar-header\"><a _ngcontent-utr-c5=\"\" class=\"app-logo cursor-pointer\" href=\"/\"><img _ngcontent-utr-c5=\"\" alt=\"logo\" class=\"app-logo-normal\" style=\"display: block; width: auto; margin: auto; max-width: 100px; max-height: 100px;\" src=\"https://im-symphonia-production-files.s3.amazonaws.com/whitelabels/admin.terragravadora.com.br/7dfeec9b-dcb2-48f4-b7f0-5751b0dd5516.png\"></a><button _ngcontent-utr-c5=\"\" type=\"button\" class=\"layout-sidebar-anchor p-link\"></button></div><div _ngcontent-utr-c5=\"\" class=\"layout-menu-container\"><!----><app-menu _ngcontent-utr-c5=\"\"><ul class=\"layout-menu\"><!----><li app-menuitem=\"\" class=\"border-top-3 border-round ng-tns-c25-5 layout-root-menuitem ng-star-inserted\"><!----><div class=\"layout-menuitem-root-text cursor-pointer ng-tns-c25-5 ng-star-inserted\" tabindex=\"0\" title=\"Dashboard\"><i class=\"layout-menuitem-icon mr-2 ng-tns-c25-5 pi pi-home\"></i> Dashboard </div><!----><!----><a tabindex=\"0\" pripple=\"\" class=\"p-element p-ripple ng-tns-c25-5 ng-star-inserted\" title=\"Dashboard\"><i class=\"layout-menuitem-icon ml-2 ng-tns-c25-5 pi pi-home\"></i><span class=\"layout-menuitem-text ml-3 ng-tns-c25-5\">Dashboard</span><!----><span class=\"p-ink\"></span></a><!----><!----><!----></li><!----><!----><!----><li app-menuitem=\"\" class=\"border-top-1 border-round ng-tns-c25-6 layout-root-menuitem ng-star-inserted\"><div class=\"layout-menuitem-root-text cursor-pointer ng-tns-c25-6 ng-star-inserted\" title=\"Distribuição digital\"><i class=\"layout-menuitem-icon mr-2 ng-tns-c25-6 icofont icofont-cloud-upload\"></i> Distribuição digital <i class=\"icon ng-tns-c25-6 pi pi-angle-down\"></i></div><!----><!----><a tabindex=\"0\" pripple=\"\" class=\"p-element p-ripple ng-tns-c25-6 ng-star-inserted\" title=\"Distribuição digital\"><i class=\"layout-menuitem-icon ng-tns-c25-6 icofont icofont-cloud-upload\"></i><span class=\"layout-menuitem-text ng-tns-c25-6\">Distribuição digital</span><i class=\"pi pi-fw pi-angle-down layout-submenu-toggler ng-tns-c25-6 ng-star-inserted\"></i><!----><span class=\"p-ink\"></span></a><!----><!----><!----><!----></li><!----><!----><!----><!----><li app-menuitem=\"\" class=\"border-top-1 border-round ng-tns-c25-7 layout-root-menuitem ng-star-inserted\"><div class=\"layout-menuitem-root-text cursor-pointer ng-tns-c25-7 ng-star-inserted\" title=\"\"><i class=\"layout-menuitem-icon mr-2 ng-tns-c25-7 icofont icofont-share-alt\"></i> Divisão de Royalties <i class=\"icon ng-tns-c25-7 pi pi-angle-down\"></i></div><!----><!----><a tabindex=\"0\" pripple=\"\" class=\"p-element p-ripple ng-tns-c25-7 ng-star-inserted\" title=\"\"><i class=\"layout-menuitem-icon ng-tns-c25-7 icofont icofont-share-alt\"></i><span class=\"layout-menuitem-text ng-tns-c25-7\">Divisão de Royalties</span><i class=\"pi pi-fw pi-angle-down layout-submenu-toggler ng-tns-c25-7 ng-star-inserted\"></i><!----><span class=\"p-ink\"></span></a><!----><!----><!----><!----></li><!----><!----><!----><!----><li app-menuitem=\"\" class=\"border-top-1 border-round ng-tns-c25-8 layout-root-menuitem ng-star-inserted\"><div class=\"layout-menuitem-root-text cursor-pointer ng-tns-c25-8 ng-star-inserted\" title=\"Dados e performance\"><i class=\"layout-menuitem-icon mr-2 ng-tns-c25-8 icofont icofont-chart-pie-alt\"></i> Dados e performance <i class=\"icon ng-tns-c25-8 pi pi-angle-down\"></i></div><!----><!----><a tabindex=\"0\" pripple=\"\" class=\"p-element p-ripple ng-tns-c25-8 ng-star-inserted\" title=\"Dados e performance\"><i class=\"layout-menuitem-icon ng-tns-c25-8 icofont icofont-chart-pie-alt\"></i><span class=\"layout-menuitem-text ng-tns-c25-8\">Dados e performance</span><i class=\"pi pi-fw pi-angle-down layout-submenu-toggler ng-tns-c25-8 ng-star-inserted\"></i><!----><span class=\"p-ink\"></span></a><!----><!----><!----><!----></li><!----><!----><!----><!----><li app-menuitem=\"\" class=\"border-top-1 border-round ng-tns-c25-9 layout-root-menuitem ng-star-inserted\"><div class=\"layout-menuitem-root-text cursor-pointer ng-tns-c25-9 ng-star-inserted\" title=\"Módulo financeiro\"><i class=\"layout-menuitem-icon mr-2 ng-tns-c25-9\"></i> Financeiro <i class=\"icon ng-tns-c25-9 pi pi-angle-down\"></i></div><!----><!----><a tabindex=\"0\" pripple=\"\" class=\"p-element p-ripple ng-tns-c25-9 ng-star-inserted\" title=\"Módulo financeiro\"><i class=\"layout-menuitem-icon ng-tns-c25-9\"></i><span class=\"layout-menuitem-text ng-tns-c25-9\">Financeiro</span><i class=\"pi pi-fw pi-angle-down layout-submenu-toggler ng-tns-c25-9 ng-star-inserted\"></i><!----><span class=\"p-ink\"></span></a><!----><!----><!----><!----></li><!----><!----><!----><!----><!----><!----></ul></app-menu></div></div></app-sidebar></div><div _ngcontent-utr-c8=\"\" class=\"topbar-end\"><ul _ngcontent-utr-c8=\"\" class=\"topbar-menu\"><li _ngcontent-utr-c8=\"\" class=\"ng-star-inserted\"><div _ngcontent-utr-c8=\"\" class=\"flex flex-row gap-2 align-items-center btn-usuario\"><p-avatar _ngcontent-utr-c8=\"\" icon=\"pi pi-user\" shape=\"circle\" size=\"large\" class=\"p-element ng-star-inserted\" title=\"TERRA PRODUÇÕES AUDIOVISUAIS LTDA\"><div class=\"p-avatar p-component p-avatar-circle p-avatar-lg\"><span class=\"pi pi-user p-avatar-icon ng-star-inserted\"></span><!----><!----><!----><!----></div></p-avatar><!----><!----><div _ngcontent-utr-c8=\"\" class=\"nome\"><strong _ngcontent-utr-c8=\"\">TERRA</strong></div><div _ngcontent-utr-c8=\"\" class=\"p-input-icon-right\" tabindex=\"0\" title=\"Perfil\"><i _ngcontent-utr-c8=\"\" class=\"pi pi-chevron-down\"></i></div></div></li><!----><!----><li _ngcontent-utr-c8=\"\"><i _ngcontent-utr-c8=\"\" pbadge=\"\" severity=\"info\" class=\"p-element icofont icofont-notification flex-shrink-0 cursor-pointer p-overlay-badge ng-star-inserted\" style=\"font-size: 1rem;\"><span id=\"pr_id_5_badge\" class=\"p-badge p-component p-badge-info p-badge-dot\"></span></i><!----><!----></li><li _ngcontent-utr-c8=\"\"><button _ngcontent-utr-c8=\"\" icon=\"pi pi-sign-out\" pbutton=\"\" type=\"button\" class=\"p-element p-button-text p-button-secondary flex-shrink-0 p-button p-component p-button-icon-only\"><span class=\"p-button-icon pi pi-sign-out\" aria-hidden=\"true\"></span></button></li></ul></div></div><p-confirmdialog _ngcontent-utr-c8=\"\" acceptbuttonstyleclass=\"p-button-raised p-button-success\" icon=\"pi pi-exclamation-triangle\" key=\"confirmacao_logoff\" rejectbuttonstyleclass=\"p-button-raised p-button-danger\" class=\"p-element ng-tns-c7-2 ng-star-inserted\"><!----></p-confirmdialog></app-topbar><!----><div class=\"layout-content-wrapper\"><div class=\"layout-content\"><router-outlet></router-outlet><app-detalhe-distribuicao _nghost-utr-c161=\"\" class=\"ng-star-inserted\"><div _ngcontent-utr-c161=\"\" id=\"detalhe-distribuicao\" class=\"p-5\"><div _ngcontent-utr-c161=\"\" class=\"flex flex-column justify-content-between gap-2\"><h1 _ngcontent-utr-c161=\"\" class=\"pb-4 m-0\">Minhas distribuições</h1><h5 _ngcontent-utr-c161=\"\" class=\"m-0 mb-5 cursor-pointer\"><i _ngcontent-utr-c161=\"\" class=\"pi pi-chevron-left mr-2\"></i> Voltar para minha lista de distribuições </h5></div><!----><div _ngcontent-utr-c161=\"\" class=\"grid card ng-star-inserted\"><div _ngcontent-utr-c161=\"\" class=\"col-12 p-5 flex flex-row justify-content-between\"><div _ngcontent-utr-c161=\"\" class=\"flex align-items-center imagem\"><app-upload-imagem _ngcontent-utr-c161=\"\" _nghost-utr-c66=\"\" class=\"ng-star-inserted\"><div _ngcontent-utr-c66=\"\" class=\"p-grid\"><!----><div _ngcontent-utr-c66=\"\" class=\"col-12 p-0\" style=\"position: relative;\"><div _ngcontent-utr-c66=\"\" class=\"imagem ng-star-inserted\"><i _ngcontent-utr-c66=\"\" class=\"pi pi-eye\"></i><img _ngcontent-utr-c66=\"\" class=\"border-round-md shadow-4 imagem\" style=\"cursor: pointer; max-width: 100%;\" src=\"https://im-symphonia-production-files.s3.amazonaws.com/distributions/3127efe9-e59b-4db7-8e83-f7442795560d/thumb_1dbbc8da-8f8a-4875-90ba-f2cadbb336d6.jpg\"></div><!----><p-galleria _ngcontent-utr-c66=\"\" class=\"p-element border-round-md shadow-4 imagem ng-tns-c61-105 ng-star-inserted\"><div class=\"ng-tns-c61-105 ng-star-inserted\"><!----></div><!----><!----></p-galleria><!----><!----></div><!----><!----><!----></div><!----></app-upload-imagem><!----></div><div _ngcontent-utr-c161=\"\" class=\"flex flex-column align-items-start justify-content-start flex-grow-1\"><div _ngcontent-utr-c161=\"\" class=\"flex flex-wrap flex-column justify-content-between gap-1 flex-grow-1 pt-2 pb-2 pl-5 pr-5\"><p _ngcontent-utr-c161=\"\" class=\"mb-2 font-bold titulo\"> Love Love </p><p _ngcontent-utr-c161=\"\" class=\"mb-2 artistas font-bold\"> Negão Chandon <!----><!----></p><div _ngcontent-utr-c161=\"\"><span _ngcontent-utr-c161=\"\" class=\"font-bold mr-2\">Status:</span><p _ngcontent-utr-c161=\"\" class=\"mb-2 status status_4\"> Lançada </p></div><p _ngcontent-utr-c161=\"\" class=\"mb-2\"><span _ngcontent-utr-c161=\"\" class=\"mr-2\">UPC:</span><span _ngcontent-utr-c161=\"\" class=\"font-bold\">8721253614623</span></p><p _ngcontent-utr-c161=\"\" class=\"mb-2\"><span _ngcontent-utr-c161=\"\" class=\"mr-2\">Lançamento:</span><span _ngcontent-utr-c161=\"\" class=\"font-bold\">3 de fevereiro de 2025</span></p><p _ngcontent-utr-c161=\"\" class=\"mb-2 mr-2 ng-star-inserted\"><span _ngcontent-utr-c161=\"\" class=\"font-bold mr-2\">Link pré-save:</span><a _ngcontent-utr-c161=\"\" class=\"link-presave\" href=\"https://terragravadora.lnk.to/Love-Love\">compartilhar</a></p><!----></div></div><div _ngcontent-utr-c161=\"\" class=\"flex flex-column gap-3 acoes-adicionais\"><h5 _ngcontent-utr-c161=\"\">Ações adicionais</h5><p-button _ngcontent-utr-c161=\"\" icon=\"pi pi-pencil\" styleclass=\"p-button-outlined btn-acao\" class=\"p-element\"><button pripple=\"\" class=\"p-ripple p-element p-button-outlined btn-acao p-button p-component\" type=\"button\"><!----><span aria-hidden=\"true\" class=\"pi pi-pencil p-button-icon p-button-icon-left ng-star-inserted\"></span><!----><span class=\"p-button-label ng-star-inserted\" aria-hidden=\"false\">Editar informações do álbum</span><!----><!----><span class=\"p-ink\"></span></button></p-button><p-button _ngcontent-utr-c161=\"\" icon=\"pi pi-dollar\" styleclass=\"p-button-outlined btn-acao\" class=\"p-element\"><button pripple=\"\" class=\"p-ripple p-element p-button-outlined btn-acao p-button p-component\" type=\"button\"><!----><span aria-hidden=\"true\" class=\"pi pi-dollar p-button-icon p-button-icon-left ng-star-inserted\"></span><!----><span class=\"p-button-label ng-star-inserted\" aria-hidden=\"false\">Criar divisão royalties</span><!----><!----><span class=\"p-ink\"></span></button></p-button><!----></div></div><hr _ngcontent-utr-c161=\"\" class=\"w-full\"><!----></div><!----><div _ngcontent-utr-c161=\"\" class=\"grid card mt-4 ng-star-inserted\"><div _ngcontent-utr-c161=\"\" class=\"col-12\"><h5 _ngcontent-utr-c161=\"\"> Faixas </h5><div _ngcontent-utr-c161=\"\" class=\"grid\"><div _ngcontent-utr-c161=\"\" class=\"col-12 border-bottom-1 ng-star-inserted\"><div _ngcontent-utr-c161=\"\" class=\"grid grid-nogutter\"><div _ngcontent-utr-c161=\"\" class=\"col-12 md:col-1\"><div _ngcontent-utr-c161=\"\" class=\"numero-faixa\"> 1 </div></div><div _ngcontent-utr-c161=\"\" class=\"col-12 md:col-5\"><div _ngcontent-utr-c161=\"\" class=\"titulo-faixa\"> Love Love <p _ngcontent-utr-c161=\"\" class=\"genero-faixa\">Forro</p></div></div><div _ngcontent-utr-c161=\"\" class=\"col-12 md:col-6 grid\"><div _ngcontent-utr-c161=\"\" class=\"col-11\"><app-upload-fonograma _ngcontent-utr-c161=\"\" tipo=\"mini\" _nghost-utr-c96=\"\"><!----><div _ngcontent-utr-c96=\"\" class=\"grid m-0\"><!----><div _ngcontent-utr-c96=\"\" class=\"col-12 p-0\"><!----><div _ngcontent-utr-c96=\"\" class=\"p-0\"><!----><div _ngcontent-utr-c96=\"\" class=\"col-12 ng-star-inserted\"><div _ngcontent-utr-c96=\"\" class=\"grid border-round border-2 border-dashed border-200 play-container\"><div _ngcontent-utr-c96=\"\" class=\"col-12 md:col-3\"><div _ngcontent-utr-c96=\"\" class=\"text-center\"><div _ngcontent-utr-c96=\"\" class=\"ng-star-inserted\"><app-btn-generico _ngcontent-utr-c96=\"\" classecssbotao=\"p-button-rounded\" icone=\"pi pi-play\" _nghost-utr-c51=\"\" class=\"ng-star-inserted\"><button _ngcontent-utr-c51=\"\" pbutton=\"\" pripple=\"\" type=\"button\" class=\"p-element p-ripple p-button-rounded p-button p-component p-button-icon-only ng-star-inserted\" title=\"\" data-placement=\"top\" data-toggle=\"tooltip\"><span class=\"p-button-icon pi pi-play\" aria-hidden=\"true\"></span><span class=\"p-ink\"></span></button><!----><!----></app-btn-generico><!----><!----></div><!----></div></div><div _ngcontent-utr-c96=\"\" class=\"col-12 md:col-9\"><div _ngcontent-utr-c96=\"\" class=\"waves-container\"><div _ngcontent-utr-c96=\"\" class=\"waves\"><section _ngcontent-utr-c96=\"\"><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 played ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-2 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-3 ng-star-inserted\"></div><div _ngcontent-utr-c96=\"\" class=\"wave with-file wave-1 ng-star-inserted\"></div><!----></section></div></div></div></div></div><!----></div></div><!----></div></app-upload-fonograma></div><div _ngcontent-utr-c161=\"\" class=\"col-1\"><button _ngcontent-utr-c161=\"\" pbutton=\"\" type=\"button\" class=\"p-element p-button-link mt-4 p-button p-component p-button-icon-only\"><span class=\"p-button-icon p-button-icon-left pi pi-chevron-up\" aria-hidden=\"true\"></span></button></div></div></div><div _ngcontent-utr-c161=\"\" class=\"flip animation-duration-100 ml-2 ng-star-inserted\" style=\"line-height: 1.5em;\"><div _ngcontent-utr-c161=\"\"><div _ngcontent-utr-c161=\"\" class=\"p-text-secondary\"> Colaboradores: </div><div _ngcontent-utr-c161=\"\" class=\"colaboradoresDaMusica ng-star-inserted\"><strong _ngcontent-utr-c161=\"\">Negão Chandon</strong> - Artista primário, Produtor </div><div _ngcontent-utr-c161=\"\" class=\"colaboradoresDaMusica ng-star-inserted\"><strong _ngcontent-utr-c161=\"\">Urbano  Caldeiro</strong> - Compositor, Letrista, Vocal </div><!----><!----><!----></div><div _ngcontent-utr-c161=\"\" class=\"mt-3\"><div _ngcontent-utr-c161=\"\" class=\"p-text-secondary\"> Dados da música: </div><div _ngcontent-utr-c161=\"\" class=\"ng-star-inserted\"><strong _ngcontent-utr-c161=\"\"> Classificação: Livre </strong></div><!----><div _ngcontent-utr-c161=\"\" class=\"ng-star-inserted\"><strong _ngcontent-utr-c161=\"\"> Gênero: Forro </strong></div><!----><div _ngcontent-utr-c161=\"\" class=\"ng-star-inserted\"><strong _ngcontent-utr-c161=\"\"> Idioma: Português </strong></div><!----><div _ngcontent-utr-c161=\"\" class=\"ng-star-inserted\"><strong _ngcontent-utr-c161=\"\"> Autoral: Sim </strong></div><!----><div _ngcontent-utr-c161=\"\"><strong _ngcontent-utr-c161=\"\"> ISRC: BXI8I2500006 </strong></div><div _ngcontent-utr-c161=\"\" class=\"ng-star-inserted\"><strong _ngcontent-utr-c161=\"\"> Instrumental: Não </strong></div><!----><div _ngcontent-utr-c161=\"\" class=\"ng-star-inserted\"><strong _ngcontent-utr-c161=\"\"> Remix: Não </strong></div><!----><div _ngcontent-utr-c161=\"\" class=\"ng-star-inserted\"><strong _ngcontent-utr-c161=\"\"> Gênero secundário:  </strong></div><!----><div _ngcontent-utr-c161=\"\" class=\"ng-star-inserted\"><strong _ngcontent-utr-c161=\"\"> Preview TikTok: 0:30seg. </strong></div><!----></div></div><!----></div><!----></div></div></div><!----></div></app-detalhe-distribuicao><!----></div><app-footer><div class=\"layout-footer\"><img alt=\"Logo\" height=\"20\" class=\"mr-2\" src=\"https://im-symphonia-production-files.s3.amazonaws.com/whitelabels/admin.terragravadora.com.br/7dfeec9b-dcb2-48f4-b7f0-5751b0dd5516.png\"><span class=\"ml-2\">2025 © Terra Gravadora <!----><!----></span></div><div style=\"display: none;\"> #VERSAO#\n</div></app-footer></div><app-profilemenu><p-sidebar position=\"right\" styleclass=\"layout-profile-sidebar w-full sm:w-25rem\" class=\"p-element ng-tns-c9-3 ng-star-inserted\"><!----></p-sidebar><p-dialog header=\"Notificação\" class=\"p-element ng-tns-c18-4 ng-star-inserted\"><!----></p-dialog></app-profilemenu><div class=\"layout-mask\" style=\"display: none;\"></div></div><app-back-top _nghost-utr-c14=\"\"><button _ngcontent-utr-c14=\"\" data-toggle=\"tooltip\" icon=\"pi pi-angle-double-up\" id=\"back-to-top\" pbutton=\"\" pripple=\"\" type=\"button\" class=\"p-element p-ripple p-button-rounded p-button p-button-sm p-component p-button-icon-only\" title=\"Ir para o topo\" style=\"display: none;\"><span class=\"p-button-icon pi pi-angle-double-up\" aria-hidden=\"true\"></span><span class=\"p-ink\"></span></button></app-back-top><app-loading-backdrop _nghost-utr-c17=\"\"><!----></app-loading-backdrop><p-toast key=\"tst_notificacoes\" class=\"p-element ng-tns-c20-0 ng-star-inserted\"><div class=\"ng-tns-c20-0 p-toast p-component p-toast-top-right\"><!----></div></p-toast><p-dialog header=\"\" class=\"p-element ng-tns-c18-1 ng-star-inserted\"><!----></p-dialog></app-layout><!----></app-root>\n<!-- Matomo -->\n<script>\n    var _paq = window._paq = window._paq || [];\n    /* tracker methods like \"setCustomDimension\" should be called before \"trackPageView\" */\n    _paq.push(['trackPageView']);\n    _paq.push(['enableLinkTracking']);\n    // (function() {\n    //     var u=\"https://analytics.trid.dev/\";\n    //     _paq.push(['setTrackerUrl', u+'matomo.php']);\n    //     _paq.push(['setSiteId', '26']);\n    //     var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\n    //     g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);\n    // })();\n</script>\n<!-- End Matomo Code -->\n<script src=\"runtime.1bdcbc71ede48d6a.js\" type=\"module\"></script><script src=\"polyfills.a5b93ee597c330e2.js\" type=\"module\"></script><script src=\"scripts.61e84e89ae6713ef.js\" defer=\"\"></script><script src=\"main.da933820aa9cfd7b.js\" type=\"module\"></script>\n\n<script defer=\"\" src=\"https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015\" integrity=\"sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==\" data-cf-beacon=\"{&quot;version&quot;:&quot;2024.11.0&quot;,&quot;token&quot;:&quot;483b75666c114ef49f1bd990be3e1381&quot;,&quot;r&quot;:1,&quot;server_timing&quot;:{&quot;name&quot;:{&quot;cfCacheStatus&quot;:true,&quot;cfEdge&quot;:true,&quot;cfExtPri&quot;:true,&quot;cfL4&quot;:true,&quot;cfOrigin&quot;:true,&quot;cfSpeedBrain&quot;:true},&quot;location_startswith&quot;:null}}\" crossorigin=\"anonymous\"></script>\n</body>","gravadora":"terra gravadora","codigo_gravadora":"100532332","requestId":"req_1762098924207_l1ztylm91","userId":"d7fc4c5a-b3da-49ab-b65b-50118675ff84","callbackUrl":"http://localhost:3000/api/n8n/callback"},"webhookUrl":"https://apps-n8n.2xtadi.easypanel.host/webhook/clavehook","executionMode":"production"}}]},"versionId":"0527de3a-8c6c-4261-90b0-61b5b7391204","activeVersionId":"0527de3a-8c6c-4261-90b0-61b5b7391204","triggerCount":1,"shared":[{"updatedAt":"2025-11-20T21:57:25.168Z","createdAt":"2025-11-20T21:57:25.168Z","role":"workflow:owner","workflowId":"ge0oVzRX9OFdB1f0","projectId":"Cf0rhzAQivp560yX"}],"activeVersion":{"updatedAt":"2025-11-26T21:17:26.817Z","createdAt":"2025-11-26T21:17:26.817Z","versionId":"0527de3a-8c6c-4261-90b0-61b5b7391204","workflowId":"ge0oVzRX9OFdB1f0","nodes":[{"parameters":{"promptType":"define","text":"={{ $json.html_extraido }}\n\nVocê é um raspador de dados profissional especializado em metadados musicais.\n\nExtraia apenas os metadados da música fornecida acima e retorne **somente JSON puro**, sem explicações, comentários ou texto fora do JSON.\n\nSiga exatamente este formato:\n\n{\n  \"artista\": \"Nome do artista\",\n  \"album\": \"Nome do álbum\",\n  \"faixas\": [\n    {\n      \"numero\": 1,\n      \"titulo\": \"Título da música\",\n      \"genero_principal\": \"Pop\",\n      \"artistas_participantes\": [\"Artista 1\", \"Artista 2\"],\n      \"compositores\": [\"Compositor 1\"],\n      \"produtores\": [\"Produtor 1\"],\n      \"vocalistas\": [\"Vocalista 1\"],\n      \"classificacao\": \"Livre\",\n      \"idioma\": \"Português\",\n      \"autoral\": \"Sim\",\n      \"isrc\": \"BR-XXX-23-00001\",\n      \"instrumental\": \"Não\",\n      \"remix\": \"Não\",\n      \"genero_secundario\": \"Eletrônico\",\n      \"preview_tiktok\": \"0:30seg\"\n    }\n  ]\n}\n\n⚠️ Regras:\n- Todos os campos devem estar presentes, mesmo se for \"Desconhecido\".\n- \"numero\" deve ser um número (sem aspas).\n- Retorne exatamente um único objeto JSON.\n- Não adicione ```json, texto introdutório ou comentários.","hasOutputParser":true,"options":{"systemMessage":"Retorne APENAS um objeto JSON válido sem nenhum texto adicional.\n\nEstrutura obrigatória:\n{\n\"artista\": \"nome do artista\",\n\"album\": \"nome do album\",\n\"genero\": \"genero musical do album\" (sertanejo, forró, rock),\n\"data de lançamento\": \"dd/mm/aaaa\",\n\"UPC\": \"upc do album\",\n\"Link da capa\": \"link da imagem da capa\",\n\"faixas\": [\n{\n\"numero\": 1,\n\"titulo\": \"nome da música\",\n\"genero_principal\": \"Sertanejo\",\n\"genero_secundario\": \"Eletrônico\",\n\"compositores\": [\"Compositor 1\"],\n\"produtores\": [\"Produtor 1\"],\n\"vocalistas\": [\"Vocalista 1\"],\n\"classificacao\": \"Livre\",\n\"idioma\": \"Português\",\n\"autoral\": \"Sim\",\n\"isrc\": \"BR-XXX-23-00001\",\n\"instrumental\": \"Não\",\n\"remix\": \"Não\",\n\"preview_tiktok\": \"0:30seg\"\n}\n]\n}\n\nNÃO adicione explicações. NÃO use markdown. Retorne SOMENTE o JSON."}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[224,272],"id":"edfb8632-b764-4cbb-85d6-bd9a6b256755","name":"AI Agent"},{"parameters":{"options":{"temperature":0.1}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[160,432],"id":"5ac29888-d701-4032-9260-3f3d02c52971","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"ktHvSkW6TllnEYHe","name":"Google Gemini(PaLM) Api (torresnet)"}}},{"parameters":{"assignments":{"assignments":[{"id":"63a49f2c-3fc6-451d-abaf-14a2e35a49f0","name":"v_html","value":"={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"conteúdo_html\"] }}","type":"string"},{"id":"ce13461c-6bf2-450d-b0df-85d365ca9b6d","name":"v_gravadora","value":"={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"gravadora\"] }}","type":"string"},{"id":"c31bf3a5-e8c0-47c4-b821-31123ea171d5","name":"v_codigo_gravadora","value":"={{ $item(\"0\").$node[\"Webhook\"].json[\"body\"][\"codigo_gravadora\"] }}","type":"string"},{"id":"209f7d05-22ce-4bdf-a23f-b78489c52418","name":"v_url_projeto_supabase","value":"https://luelnwzqzngqtoewdrnk.supabase.co","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-224,272],"id":"b660ad3b-f83d-4286-84a2-fee2cd69f22d","name":"Parametros"},{"parameters":{"jsCode":"const htmlContent = $input.first().json.v_html;\n\n// Limpa e prepara o HTML\nconst cleanHtml = htmlContent\n  .replace(/\\n/g, ' ')\n  .replace(/\\s+/g, ' ')\n  .trim();\n\nreturn {\n  html_extraido: cleanHtml\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[0,272],"id":"598811a5-0b80-484b-889d-98fdbb4dd172","name":"Limpa dados"},{"parameters":{"httpMethod":"POST","path":"clavehook","responseMode":"responseNode","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2.1,"position":[-448,272],"id":"0d9b4394-7ea3-4ec4-91d1-4742ff41bb45","name":"Webhook","webhookId":"bd94ad41-5e72-4d1c-b79a-9840d74fff9c"},{"parameters":{"respondWith":"json","responseBody":"={\n  \"status\": \"processando\",\n  \"mensagem\": \"Álbum aceito para processamento\",\n  \"album\": \"{{ $('Parametros').item.json.v_gravadora }}\",\n  \"codigo_gravadora\": \"{{ $('Parametros').item.json.v_codigo_gravadora }}\",\n  \"timestamp\": \"{{ new Date().toISOString() }}\"\n}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1.4,"position":[0,0],"id":"01d2ff70-a6c6-4f00-bf75-0cd26d4d41cc","name":"Respond to Webhook"},{"parameters":{"jsCode":"let output = $input.first().json.output || $input.first().json.text || JSON.stringify($input.first().json);\n\noutput = output.replace(/```json\\n?/g, '').replace(/```\\n?/g, '').trim();\n\nconst firstBrace = output.indexOf('{');\nconst lastBrace = output.lastIndexOf('}');\n\nif (firstBrace === -1 || lastBrace === -1) {\n  throw new Error('Nenhum JSON encontrado no output');\n}\n\noutput = output.substring(firstBrace, lastBrace + 1);\n\nconst dados = JSON.parse(output);\n\nreturn [{ json: dados }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[576,272],"id":"ca2c352a-d6bd-4f21-b6bd-639aba5969b5","name":"Trata saída"},{"parameters":{"tableId":"artistas","fieldsUi":{"fieldValues":[{"fieldId":"gravadora_id","fieldValue":"={{ $('Paga id da gravadora').item.json.id }}"},{"fieldId":"nome","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"artista\"].toLowerCase().split(' ').map((w, i) => ['de','da','do','e','no','na','dos','das','nos','nas'].includes(w) && i > 0 ? w : w.charAt(0).toUpperCase() + w.slice(1)).join(' ') }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1760,368],"id":"f91b02a3-ef27-4828-8c9c-0c1c6aa046c1","name":"Cadastra artista","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{"url":"={{ $('Parametros').item.json.v_url_projeto_supabase }}/rest/v1/gravadoras","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"nome","value":"=ilike.{{ $item(\"0\").$node[\"Parametros\"].json[\"v_gravadora\"] }}"},{"name":"select","value":"*"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[864,352],"id":"64d2ff57-8233-44a7-a698-58560224ef6c","name":"Paga id da gravadora","notesInFlow":true,"credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}},"notes":"SUPABASE"},{"parameters":{"url":"={{ $('Parametros').item.json.v_url_projeto_supabase }}/rest/v1/artistas","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"nome","value":"=ilike.{{ $('Trata saída').item.json.artista }}"},{"name":"select","value":"*"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1104,352],"id":"3ec65173-e845-493a-ab42-e8145aeca234","name":"Paga artista","notesInFlow":true,"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}},"notes":"SUPABASE"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"cb0ee1f0-61d7-4d91-98cd-2e1c6f36afb7","leftValue":"={{ $item(\"0\").$node[\"Artista existe?\"].json[\"gravadora_id\"] }}","rightValue":"={{ $item(\"0\").$node[\"Paga id da gravadora\"].json[\"id\"] }}","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1552,288],"id":"8b965729-865c-4663-bb76-c775b8ab9c12","name":"Mesma gravadora?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ea17266e-d3e2-4da7-8ae5-7c698c6d930e","leftValue":"={{ $item(\"0\").$node[\"Paga artista\"].json }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1328,352],"id":"0429c6b4-18a7-4f3b-a8d1-ba97470766c1","name":"Artista existe?"},{"parameters":{"url":"={{ $('Parametros').item.json.v_url_projeto_supabase }}/rest/v1/albuns","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"nome","value":"=ilike.{{ $('Trata saída').item.json.album }}"},{"name":"select","value":"*"}]},"sendHeaders":true,"headerParameters":{"parameters":[{}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-272,800],"id":"459c5ed6-6de2-440a-aa89-0a8098449400","name":"Paga album","notesInFlow":true,"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}},"notes":"SUPABASE"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ea17266e-d3e2-4da7-8ae5-7c698c6d930e","leftValue":"={{ $item(\"0\").$node[\"Paga album\"].json }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-48,800],"id":"06eb16c7-1663-447e-8820-bde75ca8df66","name":"Álbum existe?"},{"parameters":{"tableId":"albuns","fieldsUi":{"fieldValues":[{"fieldId":"gravadora_id","fieldValue":"={{ $('Paga id da gravadora').item.json.id }}"},{"fieldId":"nome","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"album\"].toLowerCase().split(' ').map((w, i) => ['de','da','do','e','no','na','dos','das','nos','nas'].includes(w) && i > 0 ? w : w.charAt(0).toUpperCase() + w.slice(1)).join(' ') }}"},{"fieldId":"artista_id","fieldValue":"={{ $item(\"0\").$node[\"Paga artista\"].json[\"id\"] }}"},{"fieldId":"data_lancamento","fieldValue":"={{ $node[\"Trata saída\"].json[\"data de lançamento\"].split('/').reverse().join('-') }}"},{"fieldId":"link_capa_gravadora","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"Link da capa\"] }}"},{"fieldId":"upc","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"UPC\"] }}"},{"fieldId":"genero","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"genero\"] }}"},{"fieldId":"codigo_gravadora","fieldValue":"={{ $('Parametros').item.json.v_codigo_gravadora }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[288,880],"id":"16a9ee13-faa8-4ce7-a88a-63832e5c6167","name":"Cadastra álbum","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2240,432],"id":"25cbf325-2976-4267-b970-1884186ececf","name":"nada"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[496,816],"id":"1a545587-6237-45db-9471-4b9876729292","name":"nada1"},{"parameters":{"assignments":{"assignments":[{"id":"c1e9aa32-b0af-42d1-862a-1681fce7795e","name":"faixas","value":"={{ $('Trata saída').item.json.faixas }}","type":"array"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[864,752],"id":"1d8bd4bb-218d-4edb-9bba-1a382caf93fd","name":"Faixas"},{"parameters":{"fieldToSplitOut":"faixas","options":{}},"type":"n8n-nodes-base.splitOut","typeVersion":1,"position":[1040,752],"id":"cc43f289-30e5-426d-a91d-61659b159ce1","name":"Split Out"},{"parameters":{"assignments":{"assignments":[{"id":"2dd81a7a-b24b-4c24-a22f-c1767a80a1b6","name":"nome","value":"={{ $json.titulo }}","type":"string"},{"id":"6cde504d-89cf-4bd7-b9e1-9c8a1679c6e1","name":"album_id","value":"={{ $('Paga album').item.json.id }}","type":"string"},{"id":"1adaecb9-8f62-4f5f-858a-744385068549","name":"isrc","value":"={{ $json.isrc === 'Desconhecido' ? null : $json.isrc }}","type":"string"},{"id":"7c515946-5634-4703-81dc-073f2b1632e9","name":"numero_faixa","value":"={{ $json.numero }}","type":"number"},{"id":"bb10733e-ea06-4f45-9382-eafa57624eca","name":"genero_principal","value":"={{ $json.genero_principal }}","type":"string"},{"id":"42ef9fb9-71c5-4a0f-9166-23f3e3919315","name":"genero_secundario","value":"={{ $json.genero_secundario === 'Desconhecido' ? null : $json.genero_secundario }}","type":"string"},{"id":"57e1f3b5-7f46-4b2d-bb0d-5bab2afdfb25","name":"compositores","value":"={{ $json.compositores }}","type":"array"},{"id":"417a6f04-ef0b-4f82-ad09-26e74a1a957b","name":"participacoes","value":"={{ $json.vocalistas }}","type":"string"},{"id":"5b4f733b-40a8-4412-b4b4-df46d2eb2242","name":"produtor","value":"={{ $json.produtores }}","type":"array"},{"id":"ab379dcf-eaa2-4c2a-9ba3-00a492a0b0b9","name":"classificacao","value":"={{ $json.classificacao }}","type":"string"},{"id":"32e50105-0ab5-491b-b514-680446b5a58a","name":"idioma","value":"={{ $json.idioma }}","type":"string"},{"id":"7c3fa2c6-f24b-435f-b58e-3b4e29aa43b4","name":"autoral","value":"={{ $json.autoral === 'Sim' }}","type":"boolean"},{"id":"e6cdb9be-1718-4d8c-91d3-2a6665fb7b6e","name":"instrumental","value":"={{ $json.instrumental === 'Sim' }}","type":"boolean"},{"id":"fa1b3fd2-8d34-4d29-a045-e17f2d9b7683","name":"remix","value":"={{ $json.remix === 'Sim' }}","type":"boolean"},{"id":"a29bbb76-dea7-4267-aaf5-952a61596b3a","name":"preview_tiktok","value":"={{ $json.preview_tiktok }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1216,752],"id":"c012b40e-6ee8-4435-8081-352881ae2ed6","name":"Dados da faixa"},{"parameters":{"operation":"update","tableId":"albuns","filters":{"conditions":[{"keyName":"id","condition":"eq","keyValue":"={{ $node[\"Álbum existe?\"].json[\"id\"] }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"gravadora_id","fieldValue":"={{ $('Paga id da gravadora').item.json.id }}"},{"fieldId":"nome","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"album\"].toLowerCase().split(' ').map((w, i) => ['de','da','do','e','no','na','dos','das','nos','nas'].includes(w) && i > 0 ? w : w.charAt(0).toUpperCase() + w.slice(1)).join(' ') }}"},{"fieldId":"artista_id","fieldValue":"={{ $item(\"0\").$node[\"Paga artista\"].json[\"id\"] }}"},{"fieldId":"data_lancamento","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"data de lançamento\"].split('/').reverse().join('-') }}"},{"fieldId":"link_capa_gravadora","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"Link da capa\"] }}"},{"fieldId":"upc","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"UPC\"] }}"},{"fieldId":"genero","fieldValue":"={{ $item(\"0\").$node[\"Trata saída\"].json[\"genero\"] }}"},{"fieldId":"codigo_gravadora","fieldValue":"={{ $('Parametros').item.json.v_codigo_gravadora }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[288,688],"id":"e5ddf340-de17-46d5-bbea-60b6f9a40b0e","name":"Atualiza album","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{"url":"={{ $('Parametros').item.json.v_url_projeto_supabase }}/rest/v1/musicas","authentication":"predefinedCredentialType","nodeCredentialType":"supabaseApi","sendQuery":true,"queryParameters":{"parameters":[{"name":"isrc","value":"=eq.{{ $node[\"Loop Over Items\"].json[\"isrc\"] }}"},{"name":"select","value":"*"}]},"options":{"redirect":{"redirect":{}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[1600,912],"id":"b2aac434-dd58-4b5e-92da-e5aaa5c34132","name":"Paga faixa","notesInFlow":true,"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}},"notes":"SUPABASE"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ea17266e-d3e2-4da7-8ae5-7c698c6d930e","leftValue":"={{ $node[\"Paga faixa\"].json }}","rightValue":"","operator":{"type":"object","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1792,912],"id":"bb4c46bd-a384-4784-944e-af0aa9b72f34","name":"Faixa existe?"},{"parameters":{"operation":"update","tableId":"musicas","filters":{"conditions":[{"keyName":"isrc","condition":"eq","keyValue":"={{ $('Dados da faixa').item.json.isrc }}"}]},"fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $('Dados da faixa').item.json.nome }}"},{"fieldId":"album_id","fieldValue":"={{ $('Dados da faixa').item.json.album_id }}"},{"fieldId":"numero_faixa","fieldValue":"={{ $('Dados da faixa').item.json.numero_faixa }}"},{"fieldId":"participacoes","fieldValue":"={{ $('Dados da faixa').item.json.participacoes }}"},{"fieldId":"compositores","fieldValue":"={{ $('Dados da faixa').item.json.compositores }}"},{"fieldId":"ativa","fieldValue":"=true"},{"fieldId":"produtor","fieldValue":"={{ $('Dados da faixa').item.json.produtor }}"},{"fieldId":"classificacao","fieldValue":"={{ $('Dados da faixa').item.json.classificacao }}"},{"fieldId":"genero_principal","fieldValue":"={{ $('Dados da faixa').item.json.genero_principal }}"},{"fieldId":"idioma","fieldValue":"={{ $('Dados da faixa').item.json.idioma }}"},{"fieldId":"autoral","fieldValue":"={{ $('Dados da faixa').item.json.autoral }}"},{"fieldId":"instrumental","fieldValue":"={{ $('Dados da faixa').item.json.instrumental }}"},{"fieldId":"remix","fieldValue":"={{ $('Dados da faixa').item.json.remix }}"},{"fieldId":"genero_secundario","fieldValue":"={{ $('Dados da faixa').item.json.genero_secundario }}"},{"fieldId":"preview_tiktok","fieldValue":"={{ $('Dados da faixa').item.json.preview_tiktok }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2016,800],"id":"f66e83d8-e073-4eab-a3d6-5c30f5530018","name":"Atualiza faixa","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{"tableId":"musicas","fieldsUi":{"fieldValues":[{"fieldId":"nome","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"nome\"] }}"},{"fieldId":"album_id","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"album_id\"] }}"},{"fieldId":"numero_faixa","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"numero_faixa\"] }}"},{"fieldId":"participacoes","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"participacoes\"] }}"},{"fieldId":"compositores","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"compositores\"] }}"},{"fieldId":"ativa","fieldValue":"=true"},{"fieldId":"produtor","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"produtor\"] }}"},{"fieldId":"classificacao","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"classificacao\"] }}"},{"fieldId":"genero_principal","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"genero_principal\"] }}"},{"fieldId":"idioma","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"idioma\"] }}"},{"fieldId":"autoral","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"autoral\"] }}"},{"fieldId":"instrumental","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"instrumental\"] }}"},{"fieldId":"remix","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"remix\"] }}"},{"fieldId":"genero_secundario","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"genero_secundario\"] }}"},{"fieldId":"preview_tiktok","fieldValue":"={{ $node[\"Loop Over Items\"].json[\"preview_tiktok\"] }}"},{"fieldId":"isrc","fieldValue":"={{ $node[\"Loop Over Items\"].json.isrc }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[2016,992],"id":"c1e9823b-1b81-4f57-ba95-2467852db5b0","name":"Cadastra faixa","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[1424,752],"id":"0d698db8-1c50-4943-a87e-c88190f47bea","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[2240,992],"id":"00023c01-735d-4409-b8cd-e72e25acdc73","name":"nada2"},{"parameters":{"assignments":{"assignments":[{"id":"96377f41-21bd-4d81-8afb-93ab0c8da86d","name":"v_nome_artista","value":"={{ $node[\"Trata saída\"].json[\"artista\"] }}","type":"string"},{"id":"474182cb-5093-46c7-b5c3-8f5cf51d473b","name":"v_nome_album","value":"={{ $node[\"Trata saída\"].json[\"album\"] }}","type":"string"},{"id":"756d7816-ea15-4b8a-95c5-5eaba30a83da","name":"v_quantidade_faixas","value":"={{ $node[\"Code in JavaScript\"].json[\"totalFaixas\"] }}","type":"string"},{"id":"47318b41-27eb-417f-87e7-71972f2804c1","name":"v_cod_gravadora","value":"={{ $node[\"Parametros\"].json[\"v_codigo_gravadora\"] }}","type":"string"},{"id":"b3b676dd-4787-4c6d-a25b-e947c28413d4","name":"v_id_gravadora","value":"={{ $node[\"Paga id da gravadora\"].json[\"id\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2800,608],"id":"00cf5a70-88fd-425a-bb97-ae210daefc18","name":"Preparando informações para o log"},{"parameters":{"jsCode":"// Acessa todos os itens de entrada\nconst faixas = items;\n// Calcula o número total de comentários\nconst totalFaixas = faixas.length;\n// Retorna o resultado no formato correto para o N8N\nreturn [{ json: { totalFaixas } }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2592,608],"id":"4e96d89b-2d9a-42c8-ae66-3a9fbb67551d","name":"Code in JavaScript"},{"parameters":{"content":"## Scrapping do HTML","height":416,"width":736,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-32,176],"typeVersion":1,"id":"723d79be-de40-453d-81b1-a27ddb2252b9","name":"Sticky Note"},{"parameters":{"content":"## Tratamento Artistas\n","height":416,"width":1728,"color":7},"type":"n8n-nodes-base.stickyNote","position":[752,176],"typeVersion":1,"id":"8c8a3902-5517-4070-8427-0f73fdb84ce9","name":"Sticky Note1"},{"parameters":{"content":"## Tratamento Álbum\n","height":416,"width":1264,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-560,640],"typeVersion":1,"id":"fe285e01-3d4c-4d54-a604-c257de567701","name":"Sticky Note2"},{"parameters":{"content":"## Tratamento Faixas\n","height":560,"width":1728,"color":7},"type":"n8n-nodes-base.stickyNote","position":[752,640],"typeVersion":1,"id":"b974a157-f5b9-487c-856b-97475eec3e1d","name":"Sticky Note3"},{"parameters":{"content":"## Geração de log\n","height":416,"width":1008,"color":7},"type":"n8n-nodes-base.stickyNote","position":[2528,480],"typeVersion":1,"id":"b79028aa-15e7-471d-804f-44ab6c8b044c","name":"Sticky Note4"},{"parameters":{"tableId":"log_processamento","fieldsUi":{"fieldValues":[{"fieldId":"titulo","fieldValue":"={{ $node[\"Preparando informações para o log\"].json[\"v_nome_artista\"] }}"},{"fieldId":"status","fieldValue":"true"},{"fieldId":"descricao","fieldValue":"={{ $node[\"Preparando informações para o log\"].json[\"v_nome_album\"] }} ({{ $node[\"Preparando informações para o log\"].json[\"v_quantidade_faixas\"] }} faixas)"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[3024,608],"id":"ac52cdba-4b92-420f-b516-ea3a126e29ca","name":"Atualiza log","credentials":{"supabaseApi":{"id":"d6i0u2iVVTJQNXRg","name":"[ClaveStudio] Supabase"}}}],"connections":{"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"Trata saída","type":"main","index":0}]]},"Parametros":{"main":[[{"node":"Limpa dados","type":"main","index":0},{"node":"Respond to Webhook","type":"main","index":0}]]},"Limpa dados":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"Parametros","type":"main","index":0}]]},"Trata saída":{"main":[[{"node":"Paga id da gravadora","type":"main","index":0}]]},"Paga id da gravadora":{"main":[[{"node":"Paga artista","type":"main","index":0}]]},"Paga artista":{"main":[[{"node":"Artista existe?","type":"main","index":0}]]},"Mesma gravadora?":{"main":[[{"node":"nada","type":"main","index":0}],[{"node":"Cadastra artista","type":"main","index":0}]]},"Cadastra artista":{"main":[[{"node":"Paga artista","type":"main","index":0}]]},"Artista existe?":{"main":[[{"node":"Mesma gravadora?","type":"main","index":0}],[{"node":"Cadastra artista","type":"main","index":0}]]},"Paga album":{"main":[[{"node":"Álbum existe?","type":"main","index":0}]]},"Álbum existe?":{"main":[[{"node":"Atualiza album","type":"main","index":0}],[{"node":"Cadastra álbum","type":"main","index":0}]]},"Cadastra álbum":{"main":[[{"node":"Paga album","type":"main","index":0}]]},"nada":{"main":[[{"node":"Paga album","type":"main","index":0}]]},"nada1":{"main":[[{"node":"Faixas","type":"main","index":0}]]},"Faixas":{"main":[[{"node":"Split Out","type":"main","index":0}]]},"Split Out":{"main":[[{"node":"Dados da faixa","type":"main","index":0}]]},"Dados da faixa":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Atualiza album":{"main":[[{"node":"nada1","type":"main","index":0}]]},"Paga faixa":{"main":[[{"node":"Faixa existe?","type":"main","index":0}]]},"Faixa existe?":{"main":[[{"node":"Atualiza faixa","type":"main","index":0}],[{"node":"Cadastra faixa","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"Code in JavaScript","type":"main","index":0}],[{"node":"Paga faixa","type":"main","index":0}]]},"Atualiza faixa":{"main":[[{"node":"nada2","type":"main","index":0}]]},"Cadastra faixa":{"main":[[{"node":"nada2","type":"main","index":0}]]},"nada2":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Code in JavaScript":{"main":[[{"node":"Preparando informações para o log","type":"main","index":0}]]},"Preparando informações para o log":{"main":[[{"node":"Atualiza log","type":"main","index":0}]]}},"authors":"system migration","name":null,"description":null,"autosaved":false},"tags":[]}tete